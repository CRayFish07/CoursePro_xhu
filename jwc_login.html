<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<style>
			body{
				background-color: #efeff4;
			}
			ul{
				margin: 0;
				padding: 0;
			}
			li {
				list-style: none;
			}
			li button:first-child {
				margin-left: 0;
			}
			li button {
				margin-left: 30px;
			}
		</style>
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
	</head>

	<body>
		<div class="mui-content-padded">
			<form id="login">
				<ul>
					<li>
						<input type="text" id="number" placeholder="学号" />
					</li>
					<li>
						<input type="password" id="psw" placeholder="密码" />
					</li>
					<li>
						<button class="mui-btn mui-btn-primary submit">确认</button>
						<button class="mui-btn mui-btn-primary reset">取消</button>
					</li>
				</ul>
			</form>
		</div>
		<script>
			mui.plusReady(function() {
				
				var numId = plus.storage.getItem('num');
				var myPsw = plus.storage.getItem('psw');
				
				if(numId && myPsw){
					document.getElementById('number').value = numId;
					document.getElementById('psw').value = myPsw;
				}
				
				mui('#login').on('tap', 'button', function(e) {
					var classes = e.target.classList;
					var num = document.getElementById('number');
					var psw = document.getElementById('psw');
					
					if (classes.contains('submit')) {
						
						plus.nativeUI.showWaiting();
						
						mui.ajax('http://1.xhuxm.sinaapp.com/jwxt.php', {
							data: {
								num: num.value,
								psw: psw.value
							},
							type: 'post',
							timeout: 10000,
							dataType:'json',
							success: function(data) {
								if (data.cookie && data.res == 1) {
									mui.plusReady(function() {
										plus.storage.setItem('cookie', data.cookie);
										plus.storage.setItem('num', num.value);
										plus.storage.setItem('psw', psw.value);
									});
									mui.openWindow({
										url: 'jwc_page.html',
										id: 'jwc_page',
										styles: {
											top: 0,
											bottom: 0
										},
										waiting: {
											autoShow: false
										}
									});
								}else if(data.res == 0){
									alert('密码错误');
								}else if(data.res == -1){
									alert('用户名不存在或未按照要求参加教学活动');
								}else{
									mui.toast('网络错误');
								}
								
								plus.nativeUI.closeWaiting();
							},
							error: function(xhr, type, error) {
								if(type == 'timeout'){
									plus.nativeUI.closeWaiting();
									mui.toast('网络不给力啊');
								}
							}
						});
					} else if (classes.contains('reset')) {
						num.value = '';
						psw.value = ''
					}
				});
				/*function loadUrl(url, otitle) {
					var subWebview = null;
					if (subWebview == null) {
						//获取共用父窗体
						template = plus.webview.getWebviewById("header");
					}
					if (template) {
						subWebview = template.children()[0];
						subWebview.loadURL(url);
						//修改共用父模板的标题
						mui.fire(template, 'updateHeader', {
							title: otitle
						});
						template.show('slide-in-right', 150);
					}
				}*/
			});
		</script>
	</body>

</html>